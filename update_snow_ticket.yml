- name: Update a ServiceNow ticket
  hosts: all

  vars:
    snow:
      text: "{{ message | default('INC0010107:nothing') }}"
      id: "{{ snow.text | regex_replace(':.*', '') }}"
      comment: "{{ snow.text | regex_replace('INC[0-9]+:', '') }}"

  tasks:

    - name: Debug snow
      ansible.builtin.debug:
        var: snow

    - name: Update a ServiceNow ticket with a new comment
      servicenow.itsm.incident:
        number: "{{ snow.id }}"
        other:
          work_notes: "Update recieved from EDA."
          comments: "{{ snow.comment }}"
        state: in_progress
      register: result

    - name: Retrieve a specific incident by its sys_id
      servicenow.itsm.incident_info:
        number: "{{ snow.id }}"
      register: result


...
